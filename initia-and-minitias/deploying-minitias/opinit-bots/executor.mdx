---
title: Executor
---

## How to Run Executor

<Steps>
  <Step title="Build opinitd">
    To build the `opinitd` binary, use the following command:
    ```bash
    git clone https://github.com/initia-labs/opinit-bots.git
    cd opinit-bots
    make install
    ```
  </Step>
  <Step title="Initialize Executor Bot">
    To initialize the Executor bot, use the following command:
    ```bash
    opinitd init executor
    ```
  </Step>
  <Step title= "Configuration">
    To configure the Executor, fill in the values in the `~/.opinit/executor.json file`.
    ```json executor.json
    {
      "version": 1,
      "listen_address": "localhost:3000",
      "l1_node": {
        "chain_id": "testnet-l1-1",
        "bech32_prefix": "init",
        "rpc_address": "tcp://localhost:26657",
        "gas_price": "0.15uinit",
        "gas_adjustment": 1.5,
        "tx_timeout": 60
      },
      "l2_node": {
        "chain_id": "testnet-l2-1",
        "bech32_prefix": "init",
        "rpc_address": "tcp://localhost:27657",
        "gas_price": "",
        "gas_adjustment": 1.5,
        "tx_timeout": 60
      },
      "da_node": {
        "chain_id": "testnet-l1-1",
        "bech32_prefix": "init",
        "rpc_address": "tcp://localhost:26657",
        "gas_price": "0.15uinit",
        "gas_adjustment": 1.5,
        "tx_timeout": 60
      },
      "output_submitter": "",
      "bridge_executor": "",
      "max_chunks": 5000,
      "max_chunk_size": 300000,
      "max_submission_time": 3600,
      "l2_start_height": 0,
      "batch_start_height": 0
    }
    ```
    - `version`: Indicates the version of the protocol used.
    - `listen_address`: The address where the Challenger bot listens for incoming requests.
    - `l1_node`: Information about the L1 node, including chain ID and RPC address.
    - `l2_node`: Information about the L2 node, including chain ID and RPC address.
    - `da_node`: Information about the DA node (mainly L1 or Celestia), including chain ID and RPC address.
    - `output_submitter`: The key name in the keyring for the output submitter.
    - `bridge_executor`: The key name in the keyring for the bridge executor.
    - `max_chunks`: The maximum number of chunks in a batch.
    - `max_chunk_size`: The maximum size of a chunk in a batch.
    - `max_submission_time`: The maximum time to submit a batch.
    - `l2_start_height`: This allows you to specify the starting height for the L2 chain. If set to 0, the bot will start from the latest block height. See the [Understanding Start Height Configuration](#understanding-start-height-configuration) section for more details.
    - `batch_start_height`: This allows you to specify the starting height for the DA chain. If set to 0, the bot will start from the latest block height. See the [Understanding Start Height Configuration](#understanding-start-height-configuration) section for more details.
  </Step>
  <Step title="Start Bot">
    To start the bot, use the following command:
    ```bash
    opinitd start executor
    ```
  </Step>
</Steps>

## Understanding Start Height Configuration

The Executor can be configured to start from a specific height on the L2 chain. This configuration is useful when you want to reprocess events from a certain point. If a height is already stored in the database, this configuration is ignored.

To understand the start height configuration, consider the following assumptions:

- Assume

```
Output tx #1 
- L1BlockNumber: 10
- L2BlockNumber: 100

Output tx #2
- L1BlockNumber: 20
- L2BlockNumber: 200

InitializeTokenDeposit tx #1
- Height: 5
- L1Sequence: 1

InitializeTokenDeposit tx #2
- Height: 15
- L1Sequence: 2

FinalizedTokenDeposit tx #1
- L1Sequence: 1

FinalizedTokenDeposit tx #2
- L1Sequence: 2
```

### Example #1

```json executor.json
{
  "l2_start_height": 150, 
  "batch_start_height": 0
}
```

- **Scenario**: When Child's last L1 Sequence is `2`,
  - L1 starts from the block height `11` (L1BlockNumber 10 + 1).
  - L2 starts from the block height `101` (L2BlockNumber 100 + 1).
  - Batch starts from the height `1`

### Example #2

```json executor.json
{
  "l2_start_height": 150, 
  "batch_start_height": 150
}
```

- **Scenario**: When Child's last L1 Sequence is `2`,
  - L1 starts from the block height `11` (L1BlockNumber 10 + 1).
  - L2 starts from the block height `101` (L2BlockNumber 100 + 1).
  - Batch starts from the height `150`

### Example #3

```json executor.json
{
  "l2_start_height": 150, 
  "batch_start_height": 150
}
```
- **Scenario**: When Child's last L1 Sequence is `1`,
  - L1 starts from the block height `6` (L1BlockNumber 5 + 1).
  - L2 starts from the block height `101` (L2BlockNumber 100 + 1).
  - Batch starts from the height `150`

## Query

You can query the Executor bot to get its status or view the withdrawal information:

### Status

You can query the Executor bot to get its status:

```bash
curl localhost:3000/status
```

```json
{
  "bridge_id": 1,
  "host": {
    "node": {
      "last_block_height": 0,
      "broadcaster": {
        "pending_txs": 0,
        "sequence": 0
      }
    },
    "last_proposed_output_index": 0,
    "last_proposed_output_l2_block_number": 0
  },
  "child": {
    "node": {
      "last_block_height": 0,
      "broadcaster": {
        "pending_txs": 0,
        "sequence": 0
      }
    },
    "last_updated_oracle_height": 0,
    "last_finalized_deposit_l1_block_height": 0,
    "last_finalized_deposit_l1_sequence": 0,
    "last_withdrawal_l2_sequence": 0,
    "working_tree_index": 0,
    "finalizing_block_height": 0,
    "last_output_submission_time": "",
    "next_output_submission_time": ""
  },
  "batch": {
    "node": {
      "last_block_height": 0,
    },
    "batch_info": {
      "submitter": "",
      "chain_type": ""
    },
    "current_batch_file_size": 0,
    "batch_start_block_number": 0,
    "batch_end_block_number": 0,
    "last_batch_submission_time": ""
  },
  "da": {
    "broadcaster": {
      "pending_txs": 0,
      "sequence": 0
    }
  }
}
```

### Withdrawals 

To finalize a token withdrawal, the withdrawal information is required.

Executor bot can provide withdrawal information for a given sequence:

```bash
curl localhost:3000/withdrawal/{sequence} | jq . > ./withdrawal-info.json
initiad tx ophost finalize-token-withdrawal ./withdrawal-info.json --gas= --gas-prices= --chain-id= --from=
```