---
title: Challenger
---

## Set up Dependencies

Before running OPinit bots, make sure you have the following prerequisites installed:
- [Go 1.22.2+](https://go.dev/doc/install)

<Steps>
  <Step title="Build opinitd">
    To build the `opinitd` binary, use the following command:
    ```bash
    git clone https://github.com/initia-labs/opinit-bots.git
    cd opinit-bots
    make install
    ```
  </Step>
  <Step title="Initialize Bot">
    To initialize the OPinit bots, follow these steps:
    ```bash
    opinitd init challenger
    ```
    
    Default config path is `~/.opinit/challenger.json`
    You can register keys using the following command:
    
    ```bash
    opinitd keys add [chain-id] [key-name]
    ### with mnemonic file
    opinitd keys add [chain-id] [key-name] --recover --source [mnemonic-file-path]
    ### with mnemonic input
    opinitd keys add [chain-id] [key-name] --recover
    ### with bech32 prefix
    opinitd keys add [chain-id] [key-name] --bech32=celestia
    ```
    
    These keys will be used for the bot to sign transactions.
  </Step>
</Steps>


## Run Challenger

<Steps>
  <Step title="Build opinitd">
    To build the `opinitd` binary, use the following command:
    ```bash
    git clone https://github.com/initia-labs/opinit-bots.git
    cd opinit-bots
    make install
    ```
  </Step>
  <Step title="Initialize Challenger Bot">
    To initialize the `Challenger` bot, use the following command:
    ```bash
    opinitd init challenger
    ``` 
  </Step>
  <Step title= "Configuration">
    To configure the Challenger, fill in the values in the `~/.opinit/challenger.json file`.
    ```json challenger.json
    {
      "version": 1,
      "listen_address": "localhost:3001",
      "l1_node": {
        "chain_id": "testnet-l1-1",
        "bech32_prefix": "init",
        "rpc_address": "tcp://localhost:26657",
      },
      "l2_node": {
        "chain_id": "testnet-l2-1",
        "bech32_prefix": "init",
        "rpc_address": "tcp://localhost:27657",
      },
      "l2_start_height": 0,
    }
    ```
    - `version`: Indicates the version of the OPinit spec (basically 1).
    - `listen_address`: The address where the Challenger bot listens for incoming requests.
    - `l1_node`: Information about the L1 node, including chain ID and RPC address.
    - `l2_node`: Information about the L2 node, including chain ID and RPC address.
    - `l2_start_height`: Challenger automatically sets the starting height for challenge processing. If the value is already stored in the db, this config is ignored.
  </Step>
  <Step title="Start Bot">
    To start the bot, use the following command:
    ```bash
    opinitd start challenger
    ```
    
    The following options can be set:

    - `--log-level`: log level can be set. Default log level is `info`.
    - `--polling-interval`: polling interval can be set. Default polling interval is `100ms`.
    - `--config`: config file name can be set. Default config file name is `[bot-name].json`.
    - `--home`: home dir can be set. Default home dir is `~/.opinit`.
  </Step>
</Steps>

## Query

You can query the Challenger bot to get its status or view pending events and challenges:

### Status

You can query the Challenger bot to get its status:

```bash
curl localhost:3001/status
```

```json
{
  "bridge_id": 0,
  "host": {
    "node": {
      "last_block_height": 0
    },
    "last_output_index": 0,
    "last_output_time": "",
    "num_pending_events": {}
  },
  "child": {
    "node": {
      "last_block_height": 0
    },
    "last_updated_oracle_height": 0,
    "last_finalized_deposit_l1_block_height": 0,
    "last_finalized_deposit_l1_sequence": 0,
    "last_withdrawal_l2_sequence": 0,
    "working_tree_index": 0,
    "finalizing_block_height": 0,
    "last_output_submission_time": "",
    "next_output_submission_time": "",
    "num_pending_events": {}
  },
  "latest_challenges": []
}
```

### Challenges

You can query the Challenger bot to view all challenges. The query response are paginated, with each page containing 100 challenges.

To retrieve a specific page of challenges, use the following command:

```bash
curl localhost:3001/challenges/{page}
```

```json
[
  {
    "event_type": "Oracle",
    "id": {
      "type": 2,
      "id": 136
    },
    "log": "event timeout: Oracle{L1Height: 136, Data: nUYSP4e3jTUBk33jFSYuWW28U+uTO+g3IO5/iZfbDTo, Time: 2024-09-11 06:01:21.257012 +0000 UTC}",
    "timestamp": "2024-09-11T06:05:21.284479Z"
  },
]
```

### Pending events

Each event or transaction processed in a block is saved as a `pending event`. These events are processed atomically, meaning they are either fully processed or rolled back in case of an error. If a `pending event` matches a processed event or the event exceeds its timeout, a `Challenge` is created and stored in the database for further action.

You can query the Challenger bot to view the pending events on the host (L1) and child chains (L2):

```bash
curl localhost:3001/pending_events/host
```

```json
[
  {
    "event_type": "Output",
    "l2_block_number": 2394,
    "output_index": 7,
    "output_root": "Lx+k0GuHi6jPcO5yA6dUwI/l0h4b25awy973F6CirYs=",
    "time": "2024-09-11T06:28:54.186941Z",
    "timeout": false
  }
]
```

```bash
curl localhost:3001/pending_events/child
```

```json
[
  {
    "event_type": "Oracle",
    "l1_height": 1025,
    "data": "49Y7iryZGsQYzpao+rxR2Vfaz6owp3s5vlPnkboXwr0=",
    "time": "2024-09-11T06:31:28.657245Z",
    "timeout": false
  }
]
```

## Reset Bot DB

If the database becomes corrupted or is moved to a new one, you need to initialize or reset it.

To reset the bot database, use the following command:

```bash
opinitd reset-db challenger
```