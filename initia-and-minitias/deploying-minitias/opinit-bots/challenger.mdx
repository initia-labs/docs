---
title: Challenger
---

## How to Run Challenger

<Steps>
  <Step title="Build opinitd">
    To build the `opinitd` binary, use the following command:
    ```bash
    git clone https://github.com/initia-labs/opinit-bots.git
    cd opinit-bots
    make install
    ```
  </Step>
  <Step title="Initialize Challenger Bot">
    To initialize the `Challenger` bot, use the following command:
    ```bash
    opinitd init challenger
    ``` 
  </Step>
  <Step title= "Configuration">
    To configure the Challenger, fill in the values in the `~/.opinit/challenger.json file`.
    ```json challenger.json
    {
      "version": 1,
      "listen_address": "localhost:3001",
      "l1_node": {
        "chain_id": "testnet-l1-1",
        "bech32_prefix": "init",
        "rpc_address": "tcp://localhost:26657",
      },
      "l2_node": {
        "chain_id": "testnet-l2-1",
        "bech32_prefix": "init",
        "rpc_address": "tcp://localhost:27657",
      },
      "l2_start_height": 0,
    }
    ```
    - `version`: Indicates the version of the protocol used.
    - `listen_address`: The address where the Challenger bot listens for incoming requests.
    - `l1_node`: Information about the L1 node, including chain ID and RPC address.
    - `l2_node`: Information about the L2 node, including chain ID and RPC address.
    - `l2_start_height`: This allows you to specify the starting height for the L2 chain. If set to 0, the bot will start from the latest block height. See the [Understanding Start Height Configuration](#understanding-start-height-configuration) section for more details.
  </Step>
  <Step title="Start Bot">
    To start the bot, use the following command:
    ```bash
    opinitd start challenger
    ```
  </Step>
</Steps>

## Understanding Start Height Configuration

The Challenger can be configured to start from a specific height on the L2 chain. This configuration is useful when you want to reprocess events from a certain point. If a height is already stored in the database, this configuration is ignored.

To understand the start height configuration, consider the following assumptions:

- Assume

```
Output tx #1 
- L1BlockNumber: 10
- L2BlockNumber: 100

Output tx #2
- L1BlockNumber: 20
- L2BlockNumber: 200

InitializeTokenDeposit tx #1
- Height: 5
- L1Sequence: 1

InitializeTokenDeposit tx #2
- Height: 15
- L1Sequence: 2

FinalizedTokenDeposit tx #1
- L1Sequence: 1

FinalizedTokenDeposit tx #2
- L1Sequence: 2
```

### Example #1

```json
{
  "l2_start_height": 150, 
}
```

- **Scenario**: When Child's last L1 sequence is `2`,
  - L1 starts from block height `11` (L1BlockNumber 10 + 1).
  - L2 starts from block height `101` (L2BlockNumber 100 + 1).

## Query

You can query the Challenger bot to get its status or view pending events and challenges:

### Status

You can query the Challenger bot to get its status:

```bash
curl localhost:3001/status
```

```json
{
  "bridge_id": 0,
  "host": {
    "node": {
      "last_block_height": 0
    },
    "last_output_index": 0,
    "last_output_time": "",
    "num_pending_events": {}
  },
  "child": {
    "node": {
      "last_block_height": 0
    },
    "last_updated_oracle_height": 0,
    "last_finalized_deposit_l1_block_height": 0,
    "last_finalized_deposit_l1_sequence": 0,
    "last_withdrawal_l2_sequence": 0,
    "working_tree_index": 0,
    "finalizing_block_height": 0,
    "last_output_submission_time": "",
    "next_output_submission_time": "",
    "num_pending_events": {}
  },
  "latest_challenges": []
}
```

### Challenges

You can query the Challenger bot to view the challenges by page. Each page contains 100 challenges, acting as an index that allows you to paginate through large sets of challenges efficiently. 

To retrieve a specific page of challenges, use the following command:

```bash
curl localhost:3001/challenges/{page}
```

```json
[
  {
    "event_type": "Oracle",
    "id": {
      "type": 2,
      "id": 136
    },
    "log": "event timeout: Oracle{L1Height: 136, Data: nUYSP4e3jTUBk33jFSYuWW28U+uTO+g3IO5/iZfbDTo, Time: 2024-09-11 06:01:21.257012 +0000 UTC}",
    "timestamp": "2024-09-11T06:05:21.284479Z"
  },
]
```

### Pending events

Each event or transaction processed in a block is saved as a `pending event`. These events are processed atomically, meaning they are either fully processed or rolled back in case of an error. If a `pending event` matches a processed event or the event exceeds its timeout, a `Challenge` is created and stored in the database for further action.

You can query the Challenger bot to view the pending events on the host (L1) and child chains (L2):

```bash
curl localhost:3001/pending_events/host
```

```json
[
  {
    "event_type": "Output",
    "l2_block_number": 2394,
    "output_index": 7,
    "output_root": "Lx+k0GuHi6jPcO5yA6dUwI/l0h4b25awy973F6CirYs=",
    "time": "2024-09-11T06:28:54.186941Z",
    "timeout": false
  }
]
```

```bash
curl localhost:3001/pending_events/child
```

```json
[
  {
    "event_type": "Oracle",
    "l1_height": 1025,
    "data": "49Y7iryZGsQYzpao+rxR2Vfaz6owp3s5vlPnkboXwr0=",
    "time": "2024-09-11T06:31:28.657245Z",
    "timeout": false
  }
]
```