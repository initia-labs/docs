---
title: Integration VIP
---

This guide shows how to enable VIP for an **EVM rollup** on the Initia testnet.  
For Wasm or Move rollups, follow the same steps; just use the appropriate scoring contract repository.

<Info title="Network Details">
You can find Initia L1 RPC endpoints and chain IDs in [Network Information](/resources/developer/initia-l1).
</Info>

<Steps title="VIP Integration Steps">
  <Step title="Deploy Your EVM Rollup">
    Launch your rollup using the [Weave CLI](/developers/developer-guides/tools/clis/weave-cli/rollup/introduction).
  </Step>
  <Step title="Deploy the VIP Scoring Contract">
    To deploy the VIP scoring contract:
    
    Clone [`vip-score-evm`](https://github.com/initia-labs/vip-score-evm).
    
    ```bash
    git clone https://github.com/initia-labs/vip-score-evm.git
    ```
    
    Compile `VIPScore.sol` contract. We use [Foundry](https://getfoundry.sh/) for this, but you can also use Hardhat or Truffle if you prefer. 
    
    ```bash
    forge build
    ```
    
    Deploy the contract. Make sure to set the `JSON_RPC_URL`, `PRIVATE_KEY`, and `INIT_STAGE` environment variables before running the script.
    `PRIVATE_KEY` should be the deployer's private key, and `INIT_STAGE` is the initial stage number you will use.

    ```bash
    export JSON_RPC_URL=<YOUR_RPC_URL>
    export PRIVATE_KEY=<YOUR_DEPLOYER_PRIVATE_KEY>
    export INIT_STAGE=<STAGE_NUMBER>

    forge script script/VipScore.s.sol:DeployVipScore --rpc-url $JSON_RPC_URL --broadcast

    # ...
    # ✅  [Success] Hash: 0xd55beed5a745b203b56dc68c9e9141fcfd433c4c47587ce50655a99f5c449abc
    # Contract Address: 0x1F00dfc319F1B74462B2Ef301c3978ee71f0d0E2
    # Block: 238
    # Paid: 0.000000000000525763 ETH (525763 gas * 0.000000001 gwei)

    # ✅ Sequence #1 on 1982194020580198 | Total Paid: 0.000000000000525763 ETH (525763 gas * avg 0.000000001 gwei)
    # ...
    ```
    
    Save the deployed contract address; you will need it for the whitelist proposal.
    
  </Step>
  <Step title="Register the Rollup in the Initia Registry">
    Clone the Initia Registry repository.
    
    ```bash
    git clone https://github.com/initia-labs/initia-registry.git
    ```

    Submit a pull request to merge these files into the mainnet or testnet directory, depending on your rollup's network. See the [Initia Registry](/developers/developer-guides/integrating-initia-apps/registry/introduction) for details on how to add your rollup.
  </Step>
  <Step title="Whitelist VIP Proposal">
    Draft a forum post with the whitelist template, specifying your operator address and the scoring-contract address.  
    See the [Whitelisting Rollup for VIP](/developers/developer-guides/integrating-initia-apps/vip/whitelisting-rollup-for-vip) guide for details.
  </Step>
  <Step title="Operate the VIP Scoring Contract">
    For each two-week VIP stage, use the following methods:

    | Action          | Method                             | Description                     |
    | --------------- | ---------------------------------- | ------------------------------- |
    | Start a stage   | `prepareStage(uint64 stage)`       | Start a VIP stage               |
    | Update scores   | `updateScores(stage, addrs[], amounts[])` | Batch update user scores |
    | Finalize stage  | `finalizeStage(uint64 stage)`      | Finalize scores (irreversible)  |

    This code snippet shows how to use the `viem` library to interact with the VIP scoring contract:

    ```ts
    import { createPublicClient, createWalletClient, http, parseAbi, encodeFunctionData, Hash, defineChain } from 'viem';
    import { privateKeyToAccount } from 'viem/accounts'; 
    import { RESTClient } from '@initia/initia.js';

    /* -------------------------------------------------------- *
    *  Environment variables                                   *
    * -------------------------------------------------------- */

    const JSON_RPC_URL     = '<YOUR_JSON_RPC_URL>'
    const PRIVATE_KEY      = '0xabcd1234...'
    const SCORE_CONTRACT   = '0x12345...'
    const EVM_CHAIN_ID     = '1982194020580198'
    const TARGET_STAGE     = '1' 

    const UPDATE_ADDRESSES = [
        '0x1111111111111111111111111111111111111111',
        '0x2222222222222222222222222222222222222222',
    ] as `0x${string}`[];
    const UPDATE_SCORES = [100n, 250n];


    // if you want to get the current stage, use `getCurrentStage` function and set following configuration
    const L1_VIP_CONTRACT   = '0x3a886b32a802582f2e446e74d4a24d1d7ed01adf46d2a8f65c5723887e708789' // mainnet
    const L1_REST_URL       = 'https://rest.initia.xyz'                                            // mainnet

    const chain = defineChain({
      id: parseInt(EVM_CHAIN_ID),
      name: 'MiniEVM',
      nativeCurrency: {
        decimals: 18,
        name: 'Gas Token',
        symbol: 'GAS',
      },
      rpcUrls: {
        default: {
          http: [JSON_RPC_URL],
        },
      },
    })

    const publicClient  = createPublicClient({ chain, transport: http(JSON_RPC_URL) });
    const account       = privateKeyToAccount(PRIVATE_KEY as `0x${string}`);
    const walletClient  = createWalletClient({ chain, transport: http(JSON_RPC_URL), account });

    const vipAbi = parseAbi([
        'function prepareStage(uint64 stage)',
        'function updateScores(uint64 stage, address[] addrs, uint64[] amounts)',
        'function finalizeStage(uint64 stage)',
    ]);

    async function send(txData: Hash) {
        const receipt = await publicClient.waitForTransactionReceipt({ hash: txData });
        if (receipt.status !== 'success') throw new Error(`Tx failed: ${txData}`);
        return receipt;
    }

    async function getCurrentStage(): Promise<string> {
        const rest = new RESTClient(L1_REST_URL);
        return rest.move
            .resource<any>(L1_VIP_CONTRACT, `${L1_VIP_CONTRACT}::vip::ModuleStore`)
            .then(res => res.data.stage);
    }

    async function run() {
        const stage = TARGET_STAGE; // or await getCurrentStage();
        const addrs   = UPDATE_ADDRESSES;
        const amounts = UPDATE_SCORES;

        /* updateScores ---------------------------------- */
        console.log(`updateScores(${stage}, addrs[], amounts[])`);
        const tx2 = await walletClient.sendTransaction({
            to: SCORE_CONTRACT as `0x${string}`,
            data: encodeFunctionData({
                abi: vipAbi,
                functionName: 'updateScores',
                args: [BigInt(stage), addrs, amounts],
            }),
        });
        await send(tx2);
        console.log('Scores updated successfully.');

        /* finalizeStage --------------------------------- */
        console.log(`finalizeStage(${stage})`);
        const tx3 = await walletClient.sendTransaction({
            to: SCORE_CONTRACT as `0x${string}`,
            data: encodeFunctionData({ abi: vipAbi, functionName: 'finalizeStage', args: [BigInt(stage)] }),
        });
        await send(tx3);
        console.log('Stage finalized successfully.');
    }

    run().catch(console.error);
    ```

    <Warning title="Finalization">
    `finalizeStage` is permanent. Verify all data before calling it.
    </Warning>
  </Step>
</Steps>