---
title: Integration VIP
---

This guide shows how to enable VIP for a rollup on the Initia testnet.

<Info title="Network Details">
You can find Initia L1 RPC endpoints and chain IDs in [Network Information](/resources/developer/initia-l1).
</Info>

<Steps title="VIP Integration Steps">
  <Step title="Deploy Your Rollup">
    Launch your rollup using the [Weave CLI](/developers/developer-guides/tools/clis/weave-cli/rollup/introduction).
  </Step>
  <Step title="Deploy the VIP Scoring Contract">
    To deploy the VIP scoring contract:
    
    <Tabs>
      <Tab title="EVM">
        Clone [`vip-score-evm`](https://github.com/initia-labs/vip-score-evm).
      
        ```bash
        git clone https://github.com/initia-labs/vip-score-evm.git
        ```
        
        Compile `VIPScore.sol` contract. 
        
        ```bash
        forge build
        ```

        Deploy the contract. Make sure to set the `JSON_RPC_URL`, `PRIVATE_KEY`, and `INIT_STAGE` environment variables before running the script.
        `JSON_RPC_URL` should point to your rollup's JSON RPC endpoint. `PRIVATE_KEY` should be the deployer's private key, and `INIT_STAGE` is the initial stage number you will use.

        ```bash
        export JSON_RPC_URL=<YOUR_RPC_URL>
        export PRIVATE_KEY=<YOUR_DEPLOYER_PRIVATE_KEY>
        export INIT_STAGE=<STAGE_NUMBER>

        forge script script/VipScore.s.sol:DeployVipScore --rpc-url $JSON_RPC_URL --broadcast

        # ...
        # ✅  [Success] Hash: 0xd55beed5a745b203b56dc68c9e9141fcfd433c4c47587ce50655a99f5c449abc
        # Contract Address: 0x1F00dfc319F1B74462B2Ef301c3978ee71f0d0E2
        # Block: 238
        # Paid: 0.000000000000525763 ETH (525763 gas * 0.000000001 gwei)

        # ✅ Sequence #1 on 1982194020580198 | Total Paid: 0.000000000000525763 ETH (525763 gas * avg 0.000000001 gwei)
        # ...
        ```
      </Tab>
      <Tab title="MoveVM">
        Clone [`vip-score-move`](https://github.com/initia-labs/vip-score-move).

        ```bash
        git clone https://github.com/initia-labs/vip-score-move.git
        ```

        Set `vip_score.move` deployer address on the `Move.toml` file. This address will be used to deploy the contract and interact with it.

        ```toml
        [addresses]
        vip_score = "0x1234..." # Replace with your deployer address
        ```

        Compile the Move package.

        ```bash
        cd vip-score-move
        minitiad move build
        ```

        Deploy the contract. Make sure to set the `KEY_NAME`, `GAS_PRICES`, `RPC_NODE_URL`, and `CHAIN_ID` environment variables before running the command.

        ```bash
        minitiad move deploy \
          --from $KEY_NAME \
          --gas auto \
          --gas-prices $GAS_PRICES \
          --node $RPC_NODE_URL \
          --chain-id $CHAIN_ID
        ```

        <Note>
        If you don't have MiniMove CLI installed, you can install it using the following command:
        
        ```bash
        git clone https://github.com/initia-labs/minimove.git
        cd minimove
        make install
        ```
        </Note>

      </Tab>
      <Tab title="WasmVM">
        Clone [`vip-score-wasm`](https://github.com/initia-labs/vip-score-wasm).

        ```bash
        git clone https://github.com/initia-labs/vip-score-wasm.git
        ```

        Compile the Wasm package.

        ```bash
        cd vip-score-wasm
        cargo build --release --target wasm32-unknown-unknown
        ```

        Upload the contract. Make sure to set the `KEY_NAME`, `GAS_PRICES`, `RPC_NODE_URL`, and `CHAIN_ID` environment variables before running the command.

        ```bash
        minitiad tx wasm store ./target/wasm32-unknown-unknown/release/vip_score.wasm \
          --from $KEY_NAME \
          --gas auto \
          --gas-prices $GAS_PRICES \
          --node $RPC_NODE_URL \
          --chain-id $CHAIN_ID
        ```

        Fetch the code ID from the transaction output.

        ```bash
        TX_HASH=4CDCE81C5D0FFBCB92683E64198B4DA9F449707BB4F87FCFD8E3F02EBCE042CF
        RESP=$(minitiad q tx $TX_HASH -o json --node $RPC_NODE_URL)
        echo "$RESP" | jq -r '.events[]| select(.type=="store_code").attributes[]| select(.key=="code_id").value'
        ```

        Instantiate the contract.
        
        ```bash
        ADDRESS=$(minitiad keys show $KEY_NAME -a)
        CODE_ID=100         # Replace with the actual code ID from the previous step
        INIT_STAGE=1        # Set the initial stage number
        LABEL="vip_score"   # Set the label for the contract
        INIT_MSG='{"allow_list":["'"$ADDRESS"'"],"init_stage":'"$INIT_STAGE"'}'


        minitiad tx wasm instantiate "$CODE_ID" "$INIT_MSG" \
          --admin $ADDRESS \
          --from $KEY_NAME \
          --label $LABEL \
          --gas auto \
          --gas-prices $GAS_PRICES \
          --node $RPC_NODE_URL \
          --chain-id $CHAIN_ID
        ```

        <Note>
        If you don't have MiniWasm CLI installed, you can install it using the following command:
        
        ```bash
        git clone https://github.com/initia-labs/miniwasm.git
        cd miniwasm
        make install
        ```
        </Note>
      </Tab>
    </Tabs>
    
    Save the deployed contract address; you will need it for the whitelist proposal.

  </Step>
  <Step title="Register the Rollup in the Initia Registry">
    Clone the Initia Registry repository.
    
    ```bash
    git clone https://github.com/initia-labs/initia-registry.git
    ```

    Submit a pull request to add your rollup to the Initia Registry. For detailed instructions, see the [Initia Registry](/developers/developer-guides/integrating-initia-apps/registry/introduction).
  </Step>
  <Step title="Whitelist VIP Proposal">
    Draft a forum post with the whitelist template.
    This proposal should include your operator address, the scoring policy and the VIP score contract address.
    See the [Whitelisting Rollup for VIP](/developers/developer-guides/integrating-initia-apps/vip/whitelisting-rollup-for-vip) guide for details.
    This proposal is only required for mainnet rollups.
    For testnet, you should contact Initia team for whitelisting your rollup.
  </Step>
  <Step title="Operate the VIP Scoring Contract">
    For each VIP stage, use the following methods:

    <Tabs>
      <Tab title="EVM">
        | Action          | Method                                    | Description                                                               |
        | --------------- | ----------------------------------------- | ------------------------------------------------------------------------- |
        | Update scores   | `updateScores(stage, addrs[], amounts[])` | Batch updates the scores of multiple addresses in the specified stage     |
        | Finalize stage  | `finalizeStage(uint64 stage)`             | Finalize the stage against further changes and prepare for the next stage |

        This code snippet shows how to use the [viem](https://viem.sh/) library to interact with the VIP scoring contract:
        
        <Note>
        To get EVM chain ID, you can query using the `eth_chainId` JSON RPC method.
        For example, using `curl`:
        
        ```bash
        curl -X POST https://json-rpc.minievm-2.initia.xyz/ \
          -H "Content-Type: application/json" \
          -d '{"jsonrpc":"2.0","method":"eth_chainId","params":[],"id":1}'
        ```
        </Note>

        ```ts
        import { createPublicClient, createWalletClient, http, parseAbi, encodeFunctionData, Hash, defineChain } from 'viem';
        import { privateKeyToAccount } from 'viem/accounts'; 
        import { RESTClient } from '@initia/initia.js';

        /* -------------------------------------------------------- *
        *  Environment variables                                   *
        * -------------------------------------------------------- */

        const JSON_RPC_URL     =  process.env.JSON_RPC_URL   || '<YOUR_JSON_RPC_URL>'      // Your rollup's JSON RPC endpoint
        const PRIVATE_KEY      =  process.env.PRIVATE_KEY    || '0xabcd1234...'            // Your contract deployer's private key. Do not hardcode it in production
        const SCORE_CONTRACT   =  process.env.SCORE_CONTRACT || '0x12345...'               // The deployed VIP scoring contract address  
        const EVM_CHAIN_ID     =  process.env.EVM_CHAIN_ID   || '1982194020580198'         // Your rollup's chain ID
        const TARGET_STAGE     =  process.env.TARGET_STAGE   || '1'                        // The stage number you want to update scores for
        
        /* -------------------------------------------------------- *
        *  Update addresses and scores (Mock Implementation)        *
        *  Replace these with actual addresses and scores          *
        * -------------------------------------------------------- */
      
        // ADDDRESSES and SCORES should be arrays of the same length.
        const ADDRESSES = [
            '0x1111111111111111111111111111111111111111',
            '0x2222222222222222222222222222222222222222',
        ] as `0x${string}`[];
        const SCORES = [100n, 250n];


        // if you want to get the current stage, use `getCurrentStage` function and set following configuration
        const L1_VIP_CONTRACT   = '0xe55cc823efb411bed5eed25aca5277229a54c62ab3769005f86cc44bc0c0e5ab' // testnet
        const L1_REST_URL       = 'https://rest.testnet.initia.xyz'                                    // testnet

        const chain = defineChain({
          id: parseInt(EVM_CHAIN_ID),
          name: 'MiniEVM',
          nativeCurrency: {
            decimals: 18,
            name: 'Gas Token',
            symbol: 'GAS',
          },
          rpcUrls: {
            default: {
              http: [JSON_RPC_URL],
            },
          },
        })

        const publicClient  = createPublicClient({ chain, transport: http(JSON_RPC_URL) });
        const account       = privateKeyToAccount(PRIVATE_KEY as `0x${string}`);
        const walletClient  = createWalletClient({ chain, transport: http(JSON_RPC_URL), account });

        const vipAbi = parseAbi([
            'function updateScores(uint64 stage, address[] addrs, uint64[] amounts)',
            'function finalizeStage(uint64 stage)',
        ]);

        async function send(txData: Hash) {
            const receipt = await publicClient.waitForTransactionReceipt({ hash: txData });
            if (receipt.status !== 'success') throw new Error(`Tx failed: ${txData}`);
            return receipt;
        }

        async function getCurrentStage(): Promise<string> {
            const rest = new RESTClient(L1_REST_URL);
            return rest.move
                .resource<any>(L1_VIP_CONTRACT, `${L1_VIP_CONTRACT}::vip::ModuleStore`)
                .then(res => res.data.stage);
        }

        async function run() {
          const stage = TARGET_STAGE; // or await getCurrentStage();

          /* update scores ---------------------------------- */
          const tx1 = await walletClient.sendTransaction({
              to: SCORE_CONTRACT as `0x${string}`,
              data: encodeFunctionData({
                  abi: vipAbi,
                  functionName: 'updateScores',
                  args: [BigInt(stage), ADDRESSES, SCORES],
              }),
          });
          await send(tx1);
          console.log('Scores updated successfully.');

          /* finalize stage --------------------------------- */
          const tx2 = await walletClient.sendTransaction({
              to: SCORE_CONTRACT as `0x${string}`,
              data: encodeFunctionData({ abi: vipAbi, functionName: 'finalizeStage', args: [BigInt(stage)] }),
          });
          await send(tx2);
          console.log('Stage finalized successfully.');
        }

        run().catch(console.error);
        ```
      </Tab>
      <Tab title="MoveVM">
        | Action          | Method                                                   | Description                                                               |
        | --------------- | -------------------------------------------------------- | ------------------------------------------------------------------------- |
        | Add deployer    | `add_deployer_script(signer, stage)`                     | Add the deployer to the VIP scoring contract for the specified stage      |
        | Set init stage | `set_init_stage(signer, stage)`                           | Set the initial stage for the VIP process                                   |
        | Update scores   | `update_score_script(signer, stage, addrs[], amounts[])` | Batch updates the scores of multiple addresses in the specified stage     |
        | Finalize stage  | `finalize_script(signer, stage)`                         | Finalize the stage against further changes and prepare for the next stage |

        ```ts

        import { bcs, isTxError, MnemonicKey, Msg, MsgExecute, RESTClient, Wallet } from '@initia/initia.js'

        /* -------------------------------------------------------- *
        *  Environment variables                                   *
        * -------------------------------------------------------- */

        const REST_URL = process.env.REST_URL             || '<REST_URL>'      // Your rollup's REST endpoint
        const MNEMONIC_KEY = process.env.MNEMONIC_KEY     || 'castle lung ...' // Your contract deployer's mnemonic key. Do not hardcode it in production
        const SCORE_CONTRACT = process.env.SCORE_CONTRACT || '0x12345...'      // The deployed VIP scoring contract address
        const TARGET_STAGE = process.env.TARGET_STAGE     || '1'               // The stage number you want to update scores for

        /* -------------------------------------------------------- *
        *  Update addresses and scores (Mock Implementation)        *
        *  Replace these with actual addresses and scores          *
        * -------------------------------------------------------- */

        // ADDDRESSES and SCORES should be arrays of the same length.
        const ADDRESSES = [
          '0x1111111111111111111111111111111111111111',
          '0x2222222222222222222222222222222222222222'
        ] as `0x${string}`[]
        const SCORES = [100n, 250n]

        // if you want to get the current stage, use `getCurrentStage` function and set following configuration
        const L1_VIP_CONTRACT = '0xe55cc823efb411bed5eed25aca5277229a54c62ab3769005f86cc44bc0c0e5ab' // testnet
        const L1_REST_URL = 'https://rest.testnet.initia.xyz' // testnet

        const restClient = new RESTClient(REST_URL)
        const wallet = new Wallet(
          restClient,
          new MnemonicKey({
            mnemonic: MNEMONIC_KEY
          })
        )

        async function send(msgs: Msg[]) {
          const tx = await wallet.createAndSignTx({
            msgs
          })

          const broadcastRes = await wallet.rest.tx.broadcast(tx)
          if (isTxError(broadcastRes)) {
            throw new Error(`Error while sending tx: ${broadcastRes.code} ${broadcastRes.raw_log}`)
          }
        }

        async function getCurrentStage(): Promise<string> {
          const rest = new RESTClient(L1_REST_URL)
          return rest.move.resource<any>(L1_VIP_CONTRACT, `${L1_VIP_CONTRACT}::vip::ModuleStore`).then((res) => res.data.stage)
        }

        async function run() {
          const stage = TARGET_STAGE // or await getCurrentStage();

          /* add deployer ------------------------------ */
          const msgs0 = [
            new MsgExecute(
              wallet.key.accAddress,
              SCORE_CONTRACT,
              'vip_score',
              'add_deployer_script',
              [],
              [
                bcs.address().serialize(wallet.key.accAddress).toBase64()
              ]
            )
          ]
          await send(msgs0)
          console.log('Deployer added successfully.')

          /* set initial stage ---------------------------- */
          const msgs1 = [
            new MsgExecute(
              wallet.key.accAddress,
              SCORE_CONTRACT,
              'vip_score',
              'set_init_stage',
              [],
              [
                bcs.u64().serialize(TARGET_STAGE).toBase64()
              ]
            )
          ]
          await send(msgs1)
          console.log('Initial stage set successfully.')
          
          /* update scores --------------------------------- */
          const msgs2 = [
            new MsgExecute(
              wallet.key.accAddress,
              SCORE_CONTRACT,
              'vip_score',
              'update_score_script',
              [],
              [
                bcs.u64().serialize(stage).toBase64(),
                bcs.vector(bcs.address()).serialize(ADDRESSES).toBase64(),
                bcs.vector(bcs.u64()).serialize(SCORES).toBase64()
              ]
            )
          ]
          await send(msgs2)
          console.log('Scores updated successfully.')

          /* finalize stage --------------------------------- */
          const msgs3 = [
            new MsgExecute(
              wallet.key.accAddress,
              SCORE_CONTRACT,
              'vip_score',
              'finalize_script',
              [],
              [
                bcs.u64().serialize(stage).toBase64()
              ]
            )
          ]
          await send(msgs3)
          console.log('Stage finalized successfully.')
        }

        run().catch(console.error)

        ```

      </Tab>
      <Tab title="WasmVM">
        | Action           | Method                                                   | Description                                                               |
        | ---------------- | -------------------------------------------------------- | ------------------------------------------------------------------------- |
        | Update scores    | `update_scores(signer, stage, addrs[], amounts[])`       | Batch updates the scores of multiple addresses in the specified stage     |
        | Finalize stage   | `finalize_stage(stage)`                                  | Finalize the stage against further changes and prepare for the next stage |
      
        ```ts
        import { Coins, isTxError, MnemonicKey, Msg, MsgExecuteContract, RESTClient, Wallet } from '@initia/initia.js'

        /* -------------------------------------------------------- *
        *  Environment variables                                   *
        * -------------------------------------------------------- */

        const RPC_URL = process.env.REST_URL              || 'https://rest.miniwasm-2.initia.xyz'   // Your rollup's REST endpoint
        const MNEMONIC_KEY = process.env.MNEMONIC_KEY     || 'castle ping ...'                      // Your contract deployer's mnemonic key. Do not hardcode it in production
        const SCORE_CONTRACT = process.env.SCORE_CONTRACT || 'init1ga1g...'                         // The deployed VIP scoring contract address
        const TARGET_STAGE = process.env.TARGET_STAGE     || '1'                                    // The stage number you want to update scores for

        /* -------------------------------------------------------- *
        *  Update addresses and scores (Mock Implementation)        *
        *  Replace these with actual addresses and scores          *
        * -------------------------------------------------------- */

        // ADDDRESSES and SCORES should be arrays of the same length.
        const ADDRESSES = [
          'init1lf0swvvhy3vqautdemmvunfmp0grfrjgzznx9s',
          'init1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpqr5e3d'
        ]
        const SCORES = [100, 250]

        // if you want to get the current stage, use `getCurrentStage` function and set following configuration
        const L1_VIP_CONTRACT = '0xe55cc823efb411bed5eed25aca5277229a54c62ab3769005f86cc44bc0c0e5ab' // testnet
        const L1_REST_URL = 'https://rest.testnet.initia.xyz' // testnet

        const restClient = new RESTClient(RPC_URL)
        const wallet = new Wallet(
          restClient,
          new MnemonicKey({
            mnemonic: MNEMONIC_KEY
          })
        )

        async function send(msgs: Msg[]) {
          const tx = await wallet.createAndSignTx({
            msgs
          })

          const broadcastRes = await wallet.rest.tx.broadcast(tx)
          if (isTxError(broadcastRes)) {
            throw new Error(`Error while sending tx: ${broadcastRes.code} ${broadcastRes.raw_log}`)
          }
        }

        async function getCurrentStage(): Promise<string> {
          const rest = new RESTClient(L1_REST_URL)
          return rest.move.resource<any>(L1_VIP_CONTRACT, `${L1_VIP_CONTRACT}::vip::ModuleStore`).then((res) => res.data.stage)
        }

        async function run() {
          const stage = Number(TARGET_STAGE) // or await getCurrentStage();
          
          /* update scores ----------------------------- */
          const msgs1 = [
            new MsgExecuteContract(
              wallet.key.accAddress,
              SCORE_CONTRACT,
              Buffer.from(
                JSON.stringify({
                  update_scores: {
                    stage,
                    scores: [
                      ...ADDRESSES.map((addr, i) => ([addr, SCORES[i]]))
                    ]
                  }
                })
              ).toString('base64'),
              new Coins()
            )
          ]
          await send(msgs1)
          console.log('Scores updated successfully.')

          /* finalize stage --------------------------------- */
          const msgs2 = [
            new MsgExecuteContract(
              wallet.key.accAddress,
              SCORE_CONTRACT,
              Buffer.from(
                JSON.stringify({
                  finalize_stage: {
                    stage,
                  },
                })
              ).toString('base64'),
              new Coins()
            )
          ]
          await send(msgs2)
          console.log('Stage finalized successfully.')
        }

        run().catch(console.error)
        ```
      </Tab>
    </Tabs>
  </Step>
</Steps>